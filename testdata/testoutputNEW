# The test regex and subjects we will use for the following
/\w+|^$/replace=<$&>,global,substitute_matched
    \=substitute_subject=,substitute_overwrite
 1: <>
    \=null_subject
 1: <>
    :::
 0: :::
    foo\=zero_terminate
 1: <foo>
    foo|bar\=offset=1,substitute_offset=1
 2: f<oo>|<bar>
    F|OOBAR\=offset=1
 1: F|<OOBAR>

# ####################
# ERRORS
# ####################

# substitute_subject has the same contents, but a different pointer
# Failed: error -71: substitute subject differs from prior pcre2_match call
/\w+|^$/replace=<$&>,global,substitute_matched
    \=null_subject,substitute_subject=
Failed: error -71: substitute subject differs from prior pcre2_match call
    \=null_substitute_subject
Failed: error -71: substitute subject differs from prior pcre2_match call
    \=substitute_subject=
Failed: error -71: substitute subject differs from prior pcre2_match call
    foo\=substitute_subject=foo
Failed: error -71: substitute subject differs from prior pcre2_match call


# Failed: error -72: substitute subject length differs from prior pcre2_match call
# Changing the length is always an error
# (using PCRE2_ZERO_TERMINATED but with different length strings also counts)
/\w+|^$/replace=<$&>,global,substitute_matched
    \=substitute_subject=x,substitute_overwrite
Failed: error -72: substitute subject length differs from prior pcre2_match call
    \=substitute_subject=x,substitute_overwrite,copy_matched_subject,zero_terminate,substitute_zero_terminate
Failed: error -72: substitute subject length differs from prior pcre2_match call
    foo\=substitute_subject=foooo,substitute_overwrite,copy_matched_subject,substitute_zero_terminate
Failed: error -72: substitute subject length differs from prior pcre2_match call
    :::\=substitute_subject=::,substitute_overwrite,copy_matched_subject,zero_terminate
Failed: error -72: substitute subject length differs from prior pcre2_match call
    foo\=substitute_subject=x,substitute_overwrite
Failed: error -72: substitute subject length differs from prior pcre2_match call

# Changing the start offset is not allowed
# Failed: error -73: substitute start offset differs from prior pcre2_match call
/\w+|^$/replace=<$&>,global,substitute_matched
    foo\=substitute_offset=1
Failed: error -73: substitute start offset differs from prior pcre2_match call
    :::\=offset=1,substitute_offset=0
Failed: error -73: substitute start offset differs from prior pcre2_match call
    foo\=offset=1,substitute_offset=2
Failed: error -73: substitute start offset differs from prior pcre2_match call
    :::\=offset=1,substitute_offset=10
Failed: error -73: substitute start offset differs from prior pcre2_match call

# From a strict reading of the documentation,
# using a different pointer is NOT allowed with PCRE2_COPY_MATCHED_SUBJECT
# Failed: error -71: substitute subject differs from prior pcre2_match call
/\w+|^$/replace=<$&>,global,substitute_matched
    \=substitute_subject=,copy_matched_subject
Failed: error -71: substitute subject differs from prior pcre2_match call
    \=null_substitute_subject,copy_matched_subject
 1: <>
    \=null_subject,substitute_subject=,copy_matched_subject
Failed: error -71: substitute subject differs from prior pcre2_match call
    foo\=substitute_subject=foo,copy_matched_subject
Failed: error -71: substitute subject differs from prior pcre2_match call
    :::\=substitute_subject=:::,copy_matched_subject
Failed: error -71: substitute subject differs from prior pcre2_match call

# Tests demonstrating the precedence of errors is: prior_match error, pointer, length, then start offset
/\w+|^$/replace=<$&>,global,substitute_matched
    x\=null_subject,substitute_subject=x
Failed: error -51: NULL argument passed with non-zero length
    foo\=substitute_subject=x
Failed: error -71: substitute subject differs from prior pcre2_match call
    :::\=substitute_subject=:::,offset=1,substitute_offset=0
Failed: error -71: substitute subject differs from prior pcre2_match call
    foo\=substitute_subject=x,offset=1,substitute_offset=0
Failed: error -71: substitute subject differs from prior pcre2_match call
    :::\=substitute_subject=x,substitute_overwrite,offset=1,substitute_offset=0
Failed: error -72: substitute subject length differs from prior pcre2_match call

# ####################
# ALLOWED AND GOOD
# ####################

# For simplicity, PCRE2_ZERO_TERMINATED vs a concrete length doesn't count as changing the length
/\w+|^$/replace=<$&>,global,substitute_matched
    foo\=substitute_subject=foo,substitute_overwrite,substitute_zero_terminate
 1: <foo>
    :::\=substitute_subject=:::,substitute_overwrite,zero_terminate
 0: :::
    foo\=zero_terminate,substitute_subject=foo,substitute_overwrite
 1: <foo>

# ####################
# ALLOWED AND BAD
# ####################

# Keeping the length the same, the offset the same, and the pointer the same
# Is ok, even if the contents DIFFER
# (also has some fun with copy_matched_subject)
/\w+|^$/replace=<$&>,global,substitute_matched
    foo|bar\=offset=1,substitute_subject=F|OOBAR,substitute_overwrite,zero_terminate
 2: F<|O><OBAR>

# Using null tells substitute to use the copied match_subject
/\w+|^$/replace=<$&>,global,substitute_matched
    foo|bar\=offset=1,null_substitute_subject,copy_matched_subject
 2: f<oo>|<bar>
    :::\=offset=1,null_substitute_subject,copy_matched_subject
 0: :::

# Still need the length to be correct when using null
# Failed: error -72: substitute subject length differs from prior pcre2_match call
/\w+|^$/replace=<$&>,global,substitute_matched
    foo\=substitute_subject=x,null_substitute_subject,copy_matched_subject
Failed: error -72: substitute subject length differs from prior pcre2_match call
    :::\=substitute_subject=x,null_substitute_subject,copy_matched_subject
Failed: error -72: substitute subject length differs from prior pcre2_match call

# Can use substitute_zero_terminate with copy_matched_subject
/\w+|^$/replace=<$&>,global,substitute_matched
    foo|bar\=offset=1,substitute_subject=x,substitute_overwrite,copy_matched_subject,substitute_zero_terminate
Failed: error -72: substitute subject length differs from prior pcre2_match call
    :::\=offset=1,substitute_subject=x,substitute_overwrite,copy_matched_subject,substitute_zero_terminate
Failed: error -72: substitute subject length differs from prior pcre2_match call

# Can modify text with copy_matched_subject, original text is used
/\w+|^$/replace=<$&>,global,substitute_matched
    foo|bar\=offset=1,substitute_subject=F|OOBAR,substitute_overwrite,copy_matched_subject
 2: f<oo>|<bar>
    :::\=offset=1,substitute_subject=foo,substitute_overwrite,copy_matched_subject
 0: :::
